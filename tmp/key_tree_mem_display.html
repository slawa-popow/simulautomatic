<!DOCTYPE html>
<html lang="ru-RU">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js">
    </script>
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js">
    </script>
    <!-- шрифты -->
    <link
    href="https://fonts.googleapis.com/css?family=Roboto:400,300,700&subset=latin,Cyrillic"
    rel="stylesheet"
    type="text/css"
    />
    <!-- 7 segment -->
    <link href="https://fonts.cdnfonts.com/css/seven-segment" rel="stylesheet">
    <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/segment7" type="text/css"/> 
    <!-- font-family: 'Seven Segment', sans-serif; 

        font-family: 'Segment7Standard';
        font-weight: normal;
        font-style: italic; 
    -->

    <title>клавиатура память дисплей меню</title>

    <style>
        /* сброс стилей браузера */
        * {
        box-sizing: border-box; 
        }
        html, body, div, span, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp,small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend,
        table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, 
        figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary,
        time, mark, audio, video {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            vertical-align: baseline;
        }
        article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section {
            display: block;
        }
        body {
            line-height: 1.2;
        }
        ol { 
            padding-left: 1.4em;
            list-style: decimal;
        }
        ul {
            padding-left: 1.4em;
            list-style: square;
        }
        li {
            padding: 4px;
            padding-top: 10px;
        }
        table {
            border-collapse: collapse;
            border-spacing: 0;
        } 
        /* конец кода сброса стилей браузера */
         .clear:after {
            content: " ";
            display: table;
            clear: both;
        }

        .clear {
            zoom: 1;	
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-family: 'Roboto', serif;
            background-color: rgb(240, 240, 240);
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
            -ms-hyphens: auto;
            hyphens: auto;
            word-wrap: break-word;	
        }

        .page {
            width: 90%;
            margin: 0 auto;
            background-color: white;
            border: 1px solid rgb(223, 223, 230);
            
        }
        .page h1, h2 {
           text-align: center; 
        }
        
        .page h1 {
            font-size: 1.8em;
            margin: 25px 0;
            font-weight: 500;
        }
        .page h2 {
            font-size: 1.5em;
            font-weight: 300;
            margin: 20px 0;
        }
        .header {
            min-height: 150px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: rgba(42, 98, 211, 0.868);
            color: white;
           
        }
        .content {
            padding: 10px;
            min-height: 1500px;
            display: flex;
            flex-flow: column wrap;
        }
        .content h1 {
            background-color: rgba(95, 171, 243, 0.567);
            padding: 10px 0;
        }
        .content .line{
            display: inline;
            border-bottom: 1px solid black;
            margin: 10px 0;
        }
        .segment {
            font-family: 'Segment7Standard';
            font-weight: normal;
            font-style: italic; 
            font-size: 4em;
            color: rgba(227, 13, 13, 0.805);
        }
        .memory {
            display: flex;
            flex-flow: row wrap;
            justify-content: space-around;
            align-items: center;
            min-height: 250px;
            border: 1px solid rgb(220, 220, 220);
            padding: 15px 0 15px 0;
        }
        .mempoint {
            display: flex;
            flex-flow: column nowrap;
            margin: 10px;
            height: 150px;
            width: 150px;
            border: 1px solid rgb(130, 65, 25);
        }
        
        .mempoint__data {
            margin: 5px;
            padding: 2px;
            min-height: 40px;
            background-color: rgb(233, 233, 233);
        }
        .mempoint__data:first-child {
            background-color: white;
        }
        .mempoint__data_field-0 {
            display: inline-block; 
            text-align: center; 
            color: white; 
            font-size: 1.4em; 
            background-color: rgb(185, 133, 133); 
            width: 36px; 
            height: 36px;
        }
        .mempoint__data_field-1, .mempoint__data_field-2{
            display: inline-block; 
            font-family: 'Segment7Standard';
            font-size: 2em;
            text-align: center; 
             
        }
        .mempoint__data_field-1 {
            color: rgba(227, 13, 13, 0.805);
        }
        .mempoint__data_field-2 {
            color: rgba(4, 80, 5, 0.805);
        }
        textarea {
            margin: 10px 0 10px 0;
            padding: 10px;
        }

    </style>
 
</head>
<body onload="brython({debug: 1})">

    
    <div class="page">
        <div class="header">
            <h1>Дисплей, кнопки, дерево меню, память</h1>
            <h2>Прототип</h2>
        </div>
        <!---->
        <div class="content">
            <h1>Шрифт семисегментного индикатора</h1>
            <span class="line"></span>
            <p>a b c d e f g h i j k l m n o p q r s t u w v x y z</p>
            <span class="segment"> a b c d e f g h i j k l m n o p q r s t u w v x y z</span>
            <span class="line"></span>

            <p>A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</p>
            <span class="segment">A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</span>
            <span class="line"></span>

            <p>1 2 3 4 5 6 7 8 9 0 . \ | [ ] % * / # @ + - ( ) _ ^ ? !</p>
            <span class="segment">1 2 3 4 5 6 7 8 9 0 . \ | [ ] % * / # @ + - ( ) _ ^ ? ! </span>
            <span class="line"></span>
        
            <h1>Ячейки памяти (Не полно. Для примера.)</h1>
            <div class="memory" id="memory_draw">
                <div class="mempoint" id="p0">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">0</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>
                </div>
                <div class="mempoint" id="p1">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">1</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>
                </div>
                <div class="mempoint" id="p2">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">2</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                
                </div>
                <div class="mempoint" id="p3">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">3</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p4">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">4</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p5">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">5</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p6">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">6</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>

                <div class="mempoint" id="p7">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">7</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p7">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">8</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p8">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">9</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p9">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">10</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p10">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">11</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p11">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">12</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                <div class="mempoint" id="p12">
                    <div class="mempoint__data"><span class="mempoint__data_field-0">13</span></div>
                    <div class="mempoint__data"></div>
                    <div class="mempoint__data"></div>                    
                </div>
                
            </div>

            <textarea name="logarea" id="logging" cols="30" rows="10"></textarea>
            <div style="display: block;">
                <button id="clear-area" style="padding: 8px;">очистить</button>
                <button id="mnext" style="padding: 8px;">next</button>
                <button id="mprev" style="padding: 8px;">prev</button>
            </div>
            <h1>Дерево меню</h1>
            
        </div>

    </div>



<script type="text/python">

    from browser import window, html, document, bind
    from functools import wraps
    from typing import Any, Callable, Generator
    from abc import ABC, abstractmethod
    from collections import deque
    import time
    import math
    import javascript




    class MemPoint:
        """Ячейка памяти"""

        def __init__(self, id_mem: str, name: str, value: Any = None) -> None: 
            self._id_mem: str = id_mem
            self._mem: object = document[id_mem]
            self._fields: list = self._mem.children
            self._name: str = name
            self._value: Any = self.check_value(value) 
            self._date = javascript.Date.new()

            self._area = document["logging"]

            self._field_name = self._create_field(1, self.name)
            self._field_value = self._create_field(2, self.value)


        def check_value(self, value: Any) -> str:
            return str(value) if value is not None else ""

        @property
        def name(self) -> str:
            return self._name

        @name.setter
        def name(self, v: str) -> None:
            self._name = v
            self._field_name.textContent = str(v)

        @property
        def value(self) -> Any:
            return self._value

        @value.setter
        def value(self, v: Any) -> None:
            self._value = self.check_value(v)
            
            self._field_value.textContent = self.value
            self.change_data(f"{str.zfill(str(self._date.getHours()), 2)}:{str.zfill(str(self._date.getMinutes()), 2)}:{str.zfill(str(self._date.getSeconds()), 2)}")
            

        def _create_span(self, text: Any) -> object:
            span = document.createElement("span")
            span.textContent = str(text)
            
            return span


        def _style_span(self, obj_span: object, num_field: int) -> object:
            obj_span.classList.add("mempoint__data_field-" + str(num_field))

            return obj_span


        def _create_field(self, num_field: int, value: Any) -> object:
            field = self._style_span(self._create_span(value), num_field)
            self._fields[num_field].appendChild(field)

            return field

        

        def change_data(self, date_change) -> None:
            self._area.value += f"{date_change}  Ячейка[{self._id_mem[1:]}] имя {self.name}:  Изменение ячейки. на {self.value}\r\n"
            



    class MemoryMap:

        def __init__(self) -> None:
                # список объектов ячеек
            self._memlist: list = list()
                # Ключ - имя ячейки, значение - параметр ячейки
            self._memmap: dict = dict()
            self._area = document["logging"]
            document["clear-area"].bind("click", self.clear_area)



        def add_mempoint(self, mempoint: MemPoint) -> None:
            """Добавить ячейку в карту памяти"""

            if mempoint not in self._memlist:
                self._memlist.append(mempoint)
                self._memmap[mempoint.name] = mempoint.value



        def clear_area(self, evn) -> None:
            self._area.value = ""


        def log_area(self, message: str) -> None:
            self._area.value += message




    class Component:

        def __init__(self, memory: MemoryMap) -> None:
            self._components: deque = deque()
            self._component: MemPoint = None
            self._memory: MemoryMap = memory

            self._next: object = None
            self._prev: object = None

                # Показывать этот пункт меню?
            self._is_view: bool = True
            

        def bind_memory(self, mempoint: MemPoint) -> None:
            self._memory.add_mempoint(mempoint)
            self._component = mempoint


        @property
        def next(self) -> object:
            return self._next

        @next.setter
        def next(self, obj: object) -> None:
            self._next = obj

        @property
        def prev(self) -> object:
            return self._prev

        @prev.setter
        def prev(self, obj: object) -> None:
            self._prev = obj


        @property
        def name(self) -> str:
            return self._component.name


        @name.setter
        def name(self, value: Any) -> None:
            pass

        @property
        def is_view(self) -> bool:
            return self._is_view

        @is_view.setter
        def is_view(self, b: bool) -> None:
            self._is_view = b
            

        @property
        def value(self) -> Any:
            return self._component.value


        @value.setter
        def value(self, value: Any) -> None:
            if not self.is_empty():
                self._component.value = value
            else:
                self._memory.log_area("Попытка записи в пустой компонент\r\n")


        def is_empty(self) -> bool:
            return self.value == ""

        


    class LinkedListComponent:
        """Связанный список компонентов - ветка меню"""

        def __init__(self) -> None:
            self._top: Component = None
            self._end: Component = None
            self._current: Component = None


        @property
        def current(self) -> Component:
            if self._top is None and self._end is None:
                raise Exception
            return self._current


        @current.setter
        def current(self, obj: Component) -> None:
            self._current = obj


        @property
        def next(self) -> Component:
            self.current = self.current.next
            if not self.current:
                self.current = self._top

            return self.current



        @property
        def prev(self) -> Component:
            if self.current == self._top:
                self.current = self._end
                return self.current
            if not self.current:
                self.current = self._end
            else:    
                self.current = self.current.prev

            return self.current



        def addlist(self, obj: Component) -> None:
            if not self._top:
                self._top = self._end = self._current = obj
            else:
                self._end.next = obj
                obj.prev = self._end
                self._end = obj

        



    class BaseMenu:
        """Базовый для компонентов меню"""

        def __init__(self, memory) -> None:
            self.memory = memory
            self.components: deque = deque()
            self._up = None
            self._down = None
            self._left = None
            self._right = None


            def up(self) -> None:
                pass
    

            def down(self) -> None:
                pass
    
            
            def left(self) -> None:
                pass
    
            
            def right(self) -> None:
                pass


            def add_component(self, component: BaseMenu) -> None:
                self.components.append(component)


            def printlcd(self) -> None:
                pass


    mems: list = [
        MemPoint("p0", "PAr2"),
        MemPoint("p1", "ln-t", "eCA"),
        MemPoint("p2", "ln-b", 0),
        MemPoint("p3", "UnI t", "^C"),
        MemPoint("p4", "nAuF", 8.1),
        MemPoint("p5", "oUt", "rLY"),
        MemPoint("p6", "t", 20.0),
        MemPoint("p7", "d", 1.3),
        
    ]        

    m = MemoryMap()
    components: list = []
    ll = LinkedListComponent()
    for comp in mems:
        obj_comp = Component(m)
        obj_comp.bind_memory(comp)
        # print(obj_comp.name, obj_comp.is_empty())
        components.append(obj_comp)
    
    components[0].is_view = False
    components[2].is_view = False
    components[3].is_view = False
    components[6].is_view = False
    components[4].is_view = False
    
    for c in components:
        ll.addlist(c) 


    area = document["logging"]
    area.value += f"текущий экран: {ll.current.name} = {ll.current.value}\r\n"
    @bind(document["mnext"], "click")
    def menu_next(evn):
        ll.next
        if not ll.current.is_view:
            while not ll.current.is_view:
                ll.next
        area.value += f"текущий экран: {ll.current.name} = {ll.current.value}\r\n"



    @bind(document["mprev"], "click")
    def menu_prev(evn) -> None:
        ll.prev
        if not ll.current.is_view:
            while not ll.current.is_view:
                ll.prev
        area.value += f"текущий экран: {ll.current.name} = {ll.current.value}\r\n"  

    

        
    # ----------------------------------------------------------------------------------------   

</script>
    
</body>
</html>